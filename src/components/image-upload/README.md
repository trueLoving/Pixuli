# AI 图片智能分析功能

## 功能概述

Pixuli 集成了基于 TensorFlow.js 的 AI 图片分析功能，能够自动识别图片内容并生成智能标签和描述。

## 主要特性

### 🧠 智能识别
- 使用预训练的 MobileNet 模型进行图片分类
- 支持 1000+ 种常见物体和场景识别
- 自动生成中文/英文标签和描述

### ⚡ 高性能
- WebGL 加速，支持 GPU 渲染
- 智能内存管理，自动清理资源
- 模型缓存，提升分析速度

### 🎯 可配置
- 可调节置信度阈值
- 可设置最大标签数量
- 支持中英文双语输出

## 使用方法

### 1. 图片上传时使用
1. 拖拽或选择图片文件
2. 在标签输入框旁边点击 "AI 分析" 按钮
3. 等待分析完成
4. 点击 "应用结果" 将 AI 生成的标签和描述填入表单

### 2. 分析设置
点击 AI 分析界面右上角的设置图标可以配置：
- **置信度阈值**: 控制标签识别的准确性
- **最大标签数量**: 设置返回的标签数量
- **分析语言**: 选择中文或英文输出

## 技术架构

### 核心组件
- `AIAnalysisService`: AI 分析服务核心
- `TensorFlowManager`: TensorFlow.js 管理器
- `AIAnalysis`: 分析界面组件
- `AIAnalysisSettings`: 设置配置组件

### 模型信息
- **基础模型**: MobileNet V2 (224x224)
- **预训练数据**: ImageNet 1000 类
- **推理精度**: 16-bit 浮点
- **模型大小**: ~14MB

### 性能指标
- **首次加载**: 2-5 秒（取决于网络）
- **单张图片分析**: 100-500ms
- **内存占用**: 50-100MB
- **GPU 支持**: WebGL 2.0

## 依赖要求

### 必需依赖
```json
{
  "@tensorflow/tfjs": "^4.22.0",
  "@tensorflow/tfjs-backend-webgl": "^4.22.0",
  "@tensorflow/tfjs-backend-cpu": "^4.22.0"
}
```

### 浏览器支持
- Chrome 67+
- Firefox 60+
- Safari 11+
- Edge 79+

### 硬件要求
- **推荐**: 支持 WebGL 2.0 的显卡
- **最低**: CPU 模式（较慢但兼容性好）

## 配置选项

### 环境变量
```typescript
// 模型路径配置
VITE_TF_MODEL_PATH: 本地模型路径
VITE_TF_LABELS_PATH: 本地标签文件路径
VITE_TF_BACKEND: 首选后端 (webgl/cpu/wasm)
```

### 运行时配置
```typescript
interface AIModelConfig {
  threshold: number;        // 置信度阈值 (0.1-0.9)
  maxResults: number;       // 最大标签数量 (5-20)
  language: 'zh-CN' | 'en-US'; // 输出语言
  modelPath?: string;       // 自定义模型路径
  labelsPath?: string;      // 自定义标签路径
}
```

## 故障排除

### 常见问题

#### 1. 模型加载失败
**症状**: 控制台显示 "无法加载 AI 模型"
**解决方案**: 
- 检查网络连接
- 确认浏览器支持 WebGL
- 尝试刷新页面重新加载

#### 2. 分析速度慢
**症状**: 图片分析耗时超过 5 秒
**解决方案**:
- 检查是否启用了 WebGL 后端
- 降低图片分辨率
- 调整置信度阈值

#### 3. 内存不足
**症状**: 浏览器卡顿或崩溃
**解决方案**:
- 关闭其他标签页
- 重启浏览器
- 使用 CPU 后端（较慢但内存占用少）

### 调试信息
在浏览器控制台中可以看到详细的调试信息：
```
TensorFlow.js 后端已设置为: webgl
AI 分析服务初始化完成
本地模型加载成功
标签加载完成，共 1000 个标签
```

## 扩展开发

### 添加新模型
1. 在 `public/models/` 目录下添加模型文件
2. 更新 `AIModelConfig` 接口
3. 修改 `AIAnalysisService.loadModel()` 方法

### 自定义标签
1. 准备标签文件（每行一个标签）
2. 更新 `AIAnalysisService.loadLabels()` 方法
3. 添加语言翻译映射

### 集成其他 AI 服务
1. 创建新的分析服务类
2. 实现 `AIAnalysisService` 接口
3. 在组件中切换服务

## 性能优化建议

### 开发环境
- 使用 `npm run dev` 启动开发服务器
- 启用热重载以快速测试
- 使用浏览器开发者工具监控性能

### 生产环境
- 启用模型压缩和缓存
- 使用 CDN 加速模型下载
- 实施懒加载和代码分割

### 用户体验
- 显示分析进度条
- 提供取消分析选项
- 缓存分析结果避免重复计算

## 更新日志

### v1.0.0 (2024-01-XX)
- ✨ 初始版本发布
- 🧠 集成 TensorFlow.js
- 🎯 支持图片标签识别
- 🌍 中英文双语支持
- ⚙️ 可配置分析参数

## 贡献指南

欢迎提交 Issue 和 Pull Request 来改进这个功能！

### 开发规范
- 使用 TypeScript 编写代码
- 遵循 ESLint 规则
- 添加适当的单元测试
- 更新相关文档

### 测试要求
- 单元测试覆盖率 > 80%
- 集成测试覆盖主要流程
- 性能测试确保响应时间 < 1s
- 兼容性测试覆盖主流浏览器 